<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,width=device-width">
  <style>
    body {
      padding: 0;
      margin: 0;
    }

  </style>
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">


</head>

<body>

  <div class="modal fade " id="modal-1">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">DFA</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
          </button>

        </div>
        <div class="modal-body">
          <div class="container">
            <h6>Please seperate multiple values by comma</h6>
            <div class="form-group row">
              <label for="state" class="col-3">State: </label>
              <input type="text" data-name="state" value="1,2,3" id="state" class="form-control col-9">
            </div>

            <div class="form-group row">
              <label for="alphabet" class="col-3">Alphabet: </label>
              <input type="text" data-name="alphabet" value="1,2,3" id="alphabet" class="form-control col-9">
            </div>

            <div class="form-group row">
              <label for="initial" class="col-3">Initial State: </label>
              <input type="text" data-name="initial" value="a,b,c" id="initial" class="form-control col-9">
            </div>

            <div class="form-group row">
              <label for="final" class="col-3">Final State: </label>
              <input type="text" data-name="final" value="1,2,3" id="final" class="form-control col-9">
            </div>
            <label>Transition: </label>
            <table class="table table-responsive">
              <thead>
                <tr>
                  <th>Q\&Sigma;</th>
                </tr>
              </thead>
              <tbody>

              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="save">Save changes</button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
  <!-- /.modal -->


  <button class="btn btn-primary" data-toggle="modal" data-target="#modal-1" id="modalBut">DFA Settings</button>
  <div id="parent"></div>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
  <script src="p5.min.js"></script>
  <script src="addons/p5.dom.min.js"></script>
  <script src="addons/p5.sound.min.js"></script>
  <script src="Class/DFA.js"></script>
  <script src="Class/StateCircle.js"></script>
  <script src="Class/GraphicsItem.js"></script>
  <script src="Class/curves.js"></script>
  <script src="Class/StateArc.js"></script>
  <script src="Class/DFADrawer.js"></script>
  <script src="sketch.js"></script>

  <script>

    $(document).ready(function() {

      $('#modalBut').on('click',function() {
          makeModal();
      });
      function makeModal() {
      //state
      $('#state').val(DFATuples.state.join(','));
      //initial
      $('#initial').val(DFATuples.initial.join(','));
      //final
      $('#final').val(DFATuples.final.join(','));
      //alphabet
      $('#alphabet').val(DFATuples.alphabet.join(','));

      $('tbody').html("");
      $('thead').html(`
        <tr>
          <th>Q\&Sigma;</th>
        </tr>
        `);
      //table
      let inputCheck = 1;
      let transition = DFATuples.transition;
      for(let state in transition) {
        $('tbody ').append(`<tr><th>${state}</th></tr>`)
        for(let input in transition[state]) {
          if(inputCheck)
            $('thead tr').append(`<th>${input}</th>`);
            $('tbody tr').last().append(`<td><input type="text" value = ''${transition[state][input]}' class="form-control col-10"></td>`);

        }
        inputCheck = 0;
      }
    }
    makeModal();
      $('#save').on('click',function() {
          $('#modal-1').modal('hide');
          DFATuples.state =   $('#state').val().split(',');
          DFATuples.initial =   $('#initial').val().split(',',1);
          DFATuples.final =   $('#final').val().split(',');
          DFATuples.albhabet =   $('#alphabet').val().split(',');
          DFATuples.transition = {};
          let transition = DFATuples.transition;
          //transition
          $('tbody').find('tr').each(function() {
              let state = $(this).children().eq(0).text();
              transition[state] = {};
              $(this).children().each(function(i) {
                  if(i!=0) {

                    let state2 = $(this).children().val();
                    let input = $('thead tr').children().eq(i).text();

                    transition[state][input] = state2;
                }

              });

          });
        makeModal();
        subesh.map(DFATuples);
        a.createDiagram();
        redraw();
      });


      //touch action
      $('#state,#alphabet').focusout(function() {
          let key = $(this).data('name');
          if(DFATuples[key].join(",") !== $(this).val()) {
            changeTable();
          }
      });

      function changeTable() {
        let state = $('#state').val().split(',');
        let alphabet = $('#alphabet').val().split(',');
        $('tbody').html("");
        $('thead').html(`
          <tr>
            <th>Q\&Sigma;</th>
          </tr>
          `);
          let inputCheck = 1;
          for(let i = 0; i < state.length; i++) {
            $('tbody ').append(`<tr><th>${state[i]}</th></tr>`)
            for(let j = 0; j < alphabet.length; j++) {
              if(inputCheck)
                $('thead tr').append(`<th>${alphabet[j]}</th>`);
                $('tbody tr').last().append(`<td><input type="text" class="form-control col-10"></td>`);

            }
            inputCheck = 0;
          }
      }

    });
  </script>
</body>

</html>
